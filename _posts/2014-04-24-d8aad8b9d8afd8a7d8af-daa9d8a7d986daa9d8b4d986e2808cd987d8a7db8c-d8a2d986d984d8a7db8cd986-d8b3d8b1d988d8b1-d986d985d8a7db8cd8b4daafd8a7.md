---
id: 419
title: تعداد کانکشن‌های آنلاین سرور نمایشگاه کتاب
date: 2014-04-24T00:18:54+00:00
author: امیر کریمی
layout: post
guid: http://www.dev-frame.com/?p=419
permalink: '/2014/04/%d8%aa%d8%b9%d8%af%d8%a7%d8%af-%da%a9%d8%a7%d9%86%da%a9%d8%b4%d9%86%e2%80%8c%d9%87%d8%a7%db%8c-%d8%a2%d9%86%d9%84%d8%a7%db%8c%d9%86-%d8%b3%d8%b1%d9%88%d8%b1-%d9%86%d9%85%d8%a7%db%8c%d8%b4%da%af%d8%a7/'
views:
  - "1128"
categories:
  - فناوری
tags:
  - Linux
  - Performance
  - Sysadmin
  - کارایی
  - لینوکس
---
برای یافتن کانکشن‌های برقرار شده با یک سرور می‌توانیم از دستور netstat استفاده کنیم و برای شمردن آن‌ها از دستور wc.

<pre class="brush: bash; title: ; notranslate" title="">netstat -an | wc -l

</pre>

کاراکتر | (or) خروجی دستور اول را به ورودی دستور دوم می‌فرستد. به عبارت دیگر netstat در هر خط توضیحی در مورد کانکشن می‌دهد و wc تعداد خط‌ها را شمارش می‌کند.

و برای اینکه این مقدار را به صورت مرتب و لحظه‌ای (مثلاً هر یک ثانیه یکبار) مشاهده کنیم از دستور watch در لینوکس استفاده می‌کنیم.

<pre class="brush: bash; title: ; notranslate" title="">watch -n1 'netstat -an | wc -l'

</pre>

n1 یعنی هر یک ثانیه یکبار این دستور را اجرا کن و در خروجی نمایش بده. کلاً این watch خیلی ابزار جالبی است. امکاناتی مثل هایلایت کردن تغییرات را هم دارد.

این مقدمه‌ای بود برای اینکه بگویم بین ۲۷۰ تا ۳۱۰ کانکشن فعال (در هر لحظه) بین ساعات ۱۱ شب تا ۱ صبح بر روی سرور نمایشگاه کتاب داریم. البته فعلاً سرورهای نمایشگاه (دو سرور) معماری خاصی دارند که در پست دیگری توضیح می‌دهم اما به طور خلاصه هنوز وب سایت قبلی که بر روی ویندوز بود در حال نمایش است. گلوگاه سیستم سرور لینوکسی است و درخواست‌ها با سرور Nginx به سرور ویندوزی منتقل می‌شوند.

اگر بخواهم دقیقتر بشوم باید فقط کانکشن‌های وب را حساب کنم. با استفاده از دستور grep می‌توانم این فیلتر را اعمال کنم. یعنی به دنبال کانکشن‌هایی بگردم که بر روی پورت ۸۰ برقرار شده‌اند.

<pre class="brush: bash; title: ; notranslate" title="">watch -n1 'netstat -an | grep :80 | wc -l'

</pre>

در همین بازه زمانی تعداد کانکشن‌های وبی روی این سرور بین ۱۰۰ تا ۲۰۰ عدد است. البته از ساعت ۱ صبح به بعد در حال کاهش است.

مقدار اینترنت مصرفی سرور هم امروز در حدود ۱۰۰ مگابایت بر ثانیه معادل ۸۰۰ مگابیت بر ثانیه بود.